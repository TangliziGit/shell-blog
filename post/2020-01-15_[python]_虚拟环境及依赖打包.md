
<!-- vim-markdown-toc Marked -->

* [虚拟环境及依赖打包](#虚拟环境及依赖打包)
    * [方案一: 修改路由表](#方案一:-修改路由表)
    * [方案二: socks/http代理](#方案二:-socks/http代理)
    * [方案三: docker部署](#方案三:-docker部署)
    * [方案四: 虚拟环境+pip依赖打包](#方案四:-虚拟环境+pip依赖打包)

<!-- vim-markdown-toc -->

# 虚拟环境及依赖打包
学校集群内只能访问内网, 所以在集群上不方便安装依赖.
但是我们这次使用的模型需要很多依赖, 没有外网的介入, 部署过程会十分难受.
提出三个解决方案

## 方案一: 修改路由表

`iptables` 做端口转发, 或者直接暂时改路由表.
由于没有root权限, 这个做不了


## 方案二: socks/http代理

只做过ssr的socks代理, 是个拍脑袋的方法, 需要再配proxychains.
一劳永逸的方法, 但是因为最近事多, 没有做这个方案


## 方案三: docker部署

这里存疑, 驱动也可安装?
也是个好方法, 但是需要配的东西更多: 驱动, cuda, cuddn等


## 方案四: 虚拟环境+pip依赖打包

最后图方便选择这个方案.
虚拟环境中安装依赖, 然后把所有依赖下好直接传输.
为什么不用`pipreqs`? 实测它输出的依赖不全.

```
# 本地:
virtualenv --no-site-packages venv
# 依赖安装
pip freeze > requirments.txt
pip download -r requirments.txt -d requirments/ 
```

```
# 集群:
pip install --no-index --find-links=requirements/ -r requirements.txt
```

