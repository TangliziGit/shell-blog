# ES6 æ ‡å‡†å­¦ä¹ 

> å¤§éƒ¨åˆ†å‚è€ƒ [ECMAScript 6 å…¥é—¨](https://es6.ruanyifeng.com/#docs/intro)

æ³¨æ„ ES6 æ—¢æ˜¯ä¸€ä¸ªå†å²åè¯ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ³›æŒ‡ï¼Œå«ä¹‰æ˜¯ 5.1 ç‰ˆä»¥åçš„ JavaScript çš„ä¸‹ä¸€ä»£æ ‡å‡†ï¼Œæ¶µç›–äº† ES2015ã€ES2016ã€ES2017 ç­‰ç­‰ï¼Œè€Œ ES2015 åˆ™æ˜¯æ­£å¼åç§°

éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ç‰¹æ€§ï¼š

1. `let`ï¼šå­˜åœ¨**æš‚æ—¶æ€§æ­»åŒº**
2. è§£æ„èµ‹å€¼ï¼šæ³¨æ„å¯¹è±¡ä¹Ÿå¯ä»¥è§£æ„
3. æ­£åˆ™çš„å…·åç»„åŒ¹é…



## å˜é‡å£°æ˜

> https://es6.ruanyifeng.com/#docs/let

- ES6 ä¸€å…±æœ‰ 6 ç§å£°æ˜å˜é‡çš„æ–¹æ³•ï¼š`var`ã€`function`ã€`let`ã€`const`ã€`import`ã€`class`



### let ä¸ var

ä½¿ç”¨`let`æ›¿ä»£`var`ï¼Œè¿™é‡Œè®²`var`çš„ç‰¹æ®Šå’Œå·®å¼‚ä¹‹å¤„ã€‚ä¾‹å­è¯·çœ‹å‚è€ƒé“¾æ¥ã€‚

- `var`å£°æ˜æ˜¯**å…¨å±€èŒƒå›´**çš„ï¼Œå¹¶ä¸”å¯ä»¥**é‡å¤å£°æ˜**ã€‚
- `var`å‘½ä»¤ä¼šå‘ç”Ÿâ€œ**å˜é‡æå‡**â€ç°è±¡ï¼šå˜é‡å¯ä»¥åœ¨å£°æ˜ä¹‹å‰ä½¿ç”¨ï¼Œå€¼ä¸º`undefined`ã€‚
- `let`å‘½ä»¤ä¼šå­˜åœ¨ä¸€ä¸ª**æš‚æ—¶æ€§æ­»åŒº**çš„é—®é¢˜ï¼šåªè¦å—çº§ä½œç”¨åŸŸå†…å­˜åœ¨`let`å‘½ä»¤ï¼Œå®ƒæ‰€å£°æ˜çš„å˜é‡å°±â€œç»‘å®šâ€è¿™ä¸ªåŒºåŸŸï¼Œä¸å†å—å¤–éƒ¨çš„å½±å“ã€‚
  - å¼ºè¡Œä½¿ç”¨ä¼š`ReferenceError`ã€‚
  - è¿™æ ·çš„è®¾è®¡æ˜¯ä¸ºäº†è®©å¤§å®¶å…»æˆè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œ<u>å˜é‡ä¸€å®šè¦åœ¨å£°æ˜ä¹‹åä½¿ç”¨ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚</u>

- `var`å£°æ˜åªæœ‰å…¨å±€ä½œç”¨åŸŸå’Œå‡½æ•°ä½œç”¨åŸŸï¼Œ**æ²¡æœ‰å—çº§ä½œç”¨åŸŸ**ã€‚
  - ç¬¬ä¸€ç§åœºæ™¯ï¼Œå†…å±‚å˜é‡å¯èƒ½ä¼šè¦†ç›–å¤–å±‚å˜é‡ã€‚å‡½æ•°ä½œç”¨åŸŸä¼˜å…ˆå˜é‡æå‡ï¼Œä»è€Œè¦†ç›–å…¨å±€ä½œç”¨åŸŸã€‚
  - ç¬¬äºŒç§åœºæ™¯ï¼Œç”¨æ¥è®¡æ•°çš„å¾ªç¯å˜é‡æ³„éœ²ä¸ºå…¨å±€å˜é‡ã€‚
  - å—çº§ä½œç”¨åŸŸçš„å‡ºç°ï¼Œå®é™…ä¸Šä½¿å¾—è·å¾—å¹¿æ³›åº”ç”¨çš„<u>åŒ¿åç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼</u>ï¼ˆåŒ¿å IIFEï¼‰ä¸å†å¿…è¦äº†ã€‚
  - ES6 è§„å®šï¼Œå—çº§ä½œç”¨åŸŸä¹‹ä¸­ï¼Œ<u>å‡½æ•°å£°æ˜è¯­å¥çš„è¡Œä¸ºç±»ä¼¼äº`let`</u>ï¼Œåœ¨å—çº§ä½œç”¨åŸŸä¹‹å¤–ä¸å¯å¼•ç”¨ã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œ`let`æ˜¯ä½œç”¨äº**å—çº§ä½œç”¨åŸŸ**ä¸Šçš„**ä¸å¯é‡å¤å£°æ˜**çš„å£°æ˜è¯­å¥ï¼Œä½†ä½¿ç”¨å®ƒé™å­˜åœ¨**æš‚æ—¶æ€§æ­»åŒº**çš„é—®é¢˜



### const

`const`ä¸`let`åœ¨ä¸‰ä¸ªæ–¹é¢ä¸Šä¸€æ ·ï¼š**å—çº§ä½œç”¨åŸŸ**ã€**ä¸å¯é‡å¤å£°æ˜**ã€**æš‚æ—¶æ€§æ­»åŒº**

ä½†æ˜¯æ³¨æ„ï¼š`const`ä¿è¯çš„æ˜¯å˜é‡æŒ‡å‘çš„å†…å­˜åœ°å€æ‰€ä¿å­˜çš„æ•°æ®ä¸å¾—æ”¹åŠ¨ï¼Œå³å¯¹äºåŸºæœ¬æ•°æ®æ˜¯ä¸å˜çš„ï¼Œå¯¹äºå¯¹è±¡åˆ™å†…å®¹å¯å˜è€Œå®ƒå­˜å‚¨çš„æŒ‡é’ˆä¸å˜ã€‚

å¦‚æœçœŸçš„æƒ³å°†**å¯¹è±¡å†»ç»“**ï¼Œåº”è¯¥ä½¿ç”¨`Object.freeze`æ–¹æ³•ã€‚è€Œä¸”é™¤äº†å°†å¯¹è±¡æœ¬èº«å†»ç»“ï¼Œå¯¹è±¡çš„å±æ€§ä¹Ÿåº”è¯¥å†»ç»“ã€‚



### é¡¶å±‚å¯¹è±¡

ES5 ä¹‹ä¸­ï¼Œé¡¶å±‚å¯¹è±¡çš„å±æ€§ä¸å…¨å±€å˜é‡æ˜¯ç­‰ä»·çš„ã€‚é¡¶å±‚å¯¹è±¡çš„å±æ€§ä¸å…¨å±€å˜é‡æŒ‚é’©ï¼Œè¢«è®¤ä¸ºæ˜¯ JavaScript è¯­è¨€æœ€å¤§çš„è®¾è®¡è´¥ç¬”ä¹‹ä¸€ã€‚



#### è„±é’©

ES6 ä¸ºäº†æ”¹å˜è¿™ä¸€ç‚¹ï¼Œä¸€æ–¹é¢è§„å®šï¼Œä¸ºäº†ä¿æŒå…¼å®¹æ€§ï¼Œ`var`å‘½ä»¤å’Œ`function`å‘½ä»¤å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¾æ—§æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§ï¼›å¦ä¸€æ–¹é¢è§„å®šï¼Œ`let`å‘½ä»¤ã€`const`å‘½ä»¤ã€`class`å‘½ä»¤å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¸å±äºé¡¶å±‚å¯¹è±¡çš„å±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä» ES6 å¼€å§‹ï¼Œå…¨å±€å˜é‡å°†é€æ­¥ä¸é¡¶å±‚å¯¹è±¡çš„å±æ€§è„±é’©ã€‚



#### ç»Ÿä¸€çš„é¡¶å±‚å¯¹è±¡

JavaScript è¯­è¨€å­˜åœ¨ä¸€ä¸ªé¡¶å±‚å¯¹è±¡ï¼Œå®ƒæä¾›å…¨å±€ç¯å¢ƒï¼ˆå³å…¨å±€ä½œç”¨åŸŸï¼‰ï¼Œæ‰€æœ‰ä»£ç éƒ½æ˜¯åœ¨è¿™ä¸ªç¯å¢ƒä¸­è¿è¡Œã€‚ä½†æ˜¯ï¼Œé¡¶å±‚å¯¹è±¡åœ¨å„ç§å®ç°é‡Œé¢æ˜¯ä¸ç»Ÿä¸€çš„ã€‚

[ES2020](https://github.com/tc39/proposal-global) åœ¨è¯­è¨€æ ‡å‡†çš„å±‚é¢ï¼Œå¼•å…¥`globalThis`ä½œä¸ºé¡¶å±‚å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•ç¯å¢ƒä¸‹ï¼Œ`globalThis`éƒ½æ˜¯å­˜åœ¨çš„ï¼Œéƒ½å¯ä»¥ä»å®ƒæ‹¿åˆ°é¡¶å±‚å¯¹è±¡ï¼ŒæŒ‡å‘å…¨å±€ç¯å¢ƒä¸‹çš„`this`ã€‚

å«ç‰‡åº“[`global-this`](https://github.com/ungap/global-this)æ¨¡æ‹Ÿäº†è¿™ä¸ªææ¡ˆï¼Œå¯ä»¥åœ¨æ‰€æœ‰ç¯å¢ƒæ‹¿åˆ°`globalThis`ã€‚



## è§£æ„èµ‹å€¼

- è§£æ„èµ‹å€¼çš„è§„åˆ™æ˜¯ï¼Œåªè¦ç­‰å·å³è¾¹çš„å€¼ä¸æ˜¯å¯¹è±¡æˆ–æ•°ç»„ï¼Œå°±**å…ˆå°†å…¶è½¬ä¸ºå¯¹è±¡**ã€‚ç”±äº`undefined`å’Œ`null`æ— æ³•è½¬ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹å®ƒä»¬è¿›è¡Œè§£æ„èµ‹å€¼ï¼Œéƒ½ä¼šæŠ¥é”™ã€‚



### æ•°ç»„çš„è§£æ„

ä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼š

```javascript
let [foo, [[bar], baz]] = [1, [[2], 3]];
let [ , , third] = ["foo", "bar", "baz"];
let [x, , y] = [1, 2, 3];
let [head, ...tail] = [1, 2, 3, 4];
let [x, y, ...z] = ['a'];
// y === undefined
// z === []
```

- **è§£æ„å¤±è´¥å€¼**æ˜¯`undefined`ï¼›è§£æ„**æ”¯æŒä¸å®Œå…¨è§£æ„**`let [x, y] = [1, 2, 3];`

- åªè¦æŸç§æ•°æ®ç»“æ„å…·æœ‰ **Iterator æ¥å£**ï¼Œéƒ½å¯ä»¥é‡‡ç”¨æ•°ç»„å½¢å¼çš„è§£æ„èµ‹å€¼ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™æŠ¥é”™ã€‚

  - Set ç»“æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„çš„è§£æ„èµ‹å€¼ã€‚
  - Generator å‡½æ•°ï¼ŒåŸç”Ÿå…·æœ‰ Iterator æ¥å£ã€‚

- **é»˜è®¤å€¼**ï¼šES6 å†…éƒ¨ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ`===`ï¼‰ï¼Œåˆ¤æ–­ä¸€ä¸ªä½ç½®æ˜¯å¦æœ‰å€¼ã€‚æ‰€ä»¥ï¼Œåªæœ‰å½“ä¸€ä¸ªæ•°ç»„æˆå‘˜ä¸¥æ ¼ç­‰äº`undefined`ï¼Œé»˜è®¤å€¼æ‰ä¼šç”Ÿæ•ˆã€‚åŒæ—¶å¦‚æœé»˜è®¤å€¼æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œé‚£ä¹ˆè¿™ä¸ª**è¡¨è¾¾å¼æ˜¯æƒ°æ€§æ±‚å€¼**çš„

  ```javascript
  let [x = 1] = [undefined];
  x // 1
  
  let [x = 1] = [null];
  x // null
  ```

- å¯ä»¥å°†ä¸€ä¸ªå·²ç»å£°æ˜çš„å˜é‡ç”¨äºè§£æ„èµ‹å€¼ã€‚



### å¯¹è±¡çš„è§£æ„

```javascript
let { bar, foo } = { foo: 'aaa', bar: 'bbb' };
foo // "aaa"
bar // "bbb"

let { baz } = { foo: 'aaa', bar: 'bbb' };
baz // undefined

let { first: f, last: l } = { first: 'hello', last: 'world' };
f // 'hello'
l // 'world'

var {x: y = 3} = {x: 5};
y // 5
```

- **è§£æ„å¤±è´¥å€¼**æ˜¯`undefined`
- è§£æ„å¯ä»¥ç»™å®šæ›¿æ¢çš„ keyï¼Œå¦‚ä¾‹3ã€‚**æ³¨æ„**è¢«æ›¿æ¢çš„æ˜¯åè€…ï¼Œè€Œä¸æ˜¯å‰è€…ã€‚å°±åƒå£°æ˜ä¸€å¯¹kvä¸€æ ·ï¼ŒæŠŠå®ƒå½“ä½œæ¨¡å¼åŒ¹é…ã€‚



**æ³¨æ„**ï¼š

- å¦‚æœè¦å°†ä¸€ä¸ªå·²ç»å£°æ˜çš„å˜é‡ç”¨äºè§£æ„èµ‹å€¼ï¼š

  ```javascript
  let x;
  ({x} = {x: 1});
  ```



### å½¢å‚çš„è§£æ„

```javascript
const add = ([x, y]) => x + y;
```



### ç”¨å¤„

1. **å¿«é€Ÿæå– JSON æ•°æ®**
2. **å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼**ï¼šé¿å…äº†åœ¨å‡½æ•°ä½“å†…éƒ¨å†å†™`var foo = config.foo || 'default foo';`è¿™æ ·çš„è¯­å¥ã€‚
3. **éå† Map ç»“æ„**ï¼šä»»ä½•éƒ¨ç½²äº† Iterator æ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ç”¨`for...of`å¾ªç¯éå†ã€‚



## å­—ç¬¦ä¸²çš„æ‰©å±•

1. **å­—ç¬¦çš„ Unicode è¡¨ç¤ºæ³•**ï¼šES6 å…è®¸é‡‡ç”¨`\uxxxx`å½¢å¼è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­`xxxx`è¡¨ç¤ºå­—ç¬¦çš„ Unicode ç ç‚¹ã€‚

2. **å­—ç¬¦ä¸²çš„éå†å™¨æ¥å£**ï¼šé™¤äº†éå†å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªéå†å™¨æœ€å¤§çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è¯†åˆ«å¤§äº`0xFFFF`çš„ç ç‚¹ï¼Œä¼ ç»Ÿçš„`for`å¾ªç¯æ— æ³•è¯†åˆ«è¿™æ ·çš„ç ç‚¹ã€‚

3. **æ¨¡æ¿å­—ç¬¦ä¸²**ï¼šå¯ä»¥ç”¨æ¥å®šä¹‰å¤šè¡Œå­—ç¬¦ä¸²ï¼Œæˆ–è€…åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡ã€‚

   - **æ ‡ç­¾æ¨¡æ¿**ï¼šå®ƒå¯ä»¥ç´§è·Ÿåœ¨ä¸€ä¸ªå‡½æ•°ååé¢ï¼Œè¯¥å‡½æ•°å°†è¢«è°ƒç”¨æ¥å¤„ç†è¿™ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ã€‚

     ```javascript
     alert`hello`
     // ç­‰åŒäº
     alert(['hello'])
     
     // ä¸‹é¢æ˜¯ä¸€äº›åº”ç”¨ï¼Œæ˜¯è‡ªå®šä¹‰å‡½æ•°å¯¹æ ‡ç­¾æ¨¡æ¿è¿›è¡Œå¤„ç†ï¼š
     // 1. è¿‡æ»¤ HTML å­—ç¬¦ä¸²
     // 2. å¤šè¯­è¨€è½¬æ¢
     // 3. åµŒå…¥å…¶ä»–è¯­è¨€
     ```



### æ–°å¢æ–¹æ³•

1. `String.fromCharPoint()`ï¼šç”¨äºä» Unicode ç ç‚¹è¿”å›å¯¹åº”å­—ç¬¦ï¼Œç›¸æ¯” ES5 å®ƒèƒ½è¯†åˆ«ç ç‚¹å¤§äº`0xFFFF`çš„å­—ç¬¦ã€‚

2. `String.raw()`ï¼šè¿”å›ä¸€ä¸ªæ–œæ éƒ½è¢«è½¬ä¹‰ï¼ˆå³æ–œæ å‰é¢å†åŠ ä¸€ä¸ªæ–œæ ï¼‰çš„å­—ç¬¦ä¸²ã€‚

3. **å®ä¾‹æ–¹æ³•`codePointAt()`**ï¼šèƒ½å¤Ÿæ­£ç¡®å¤„ç† 4 ä¸ªå­—èŠ‚å‚¨å­˜çš„å­—ç¬¦ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦çš„ç ç‚¹ã€‚

   - JavaScript å†…éƒ¨ï¼Œ**å­—ç¬¦ä»¥ UTF-16 çš„æ ¼å¼å‚¨å­˜**ã€‚å½“é‡åˆ°2ä¸ªå­—èŠ‚ç»„æˆçš„å­—ç¬¦æ—¶ï¼š

   - `charAt()`æ–¹æ³•æ— æ³•è¯»å–æ•´ä¸ªå­—ç¬¦

   - `charCodeAt()`æ–¹æ³•åªèƒ½åˆ†åˆ«è¿”å›å‰ä¸¤ä¸ªå­—èŠ‚å’Œåä¸¤ä¸ªå­—èŠ‚çš„å€¼ã€‚

   - `codePointAt()`æ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦çš„ç ç‚¹ã€‚**æ³¨æ„**ï¼šä¸ºäº†å¯¹é½å­—ç¬¦ä¸²é•¿åº¦ï¼Œå½“ç´¢å¼•æŒ‡å‘å­—ç¬¦ååŠæ®µæ—¶ï¼Œè¿”å›å€¼ç­‰äº`charCodeAt()`

     ```javascript
     var s = "ğ ®·";
     
     s.length // 2
     s.charAt(0) // ''
     s.charAt(1) // ''
     s.charCodeAt(0) // 55362
     s.charCodeAt(1) // 57271
     s.codePointAt(0) // 134071
     s.codePointAt(1) // 57271
     s.codePointAt(0).toString(16) // "20bb7"
     ```

4. å®ä¾‹æ–¹æ³•`normalize()`ï¼šç”¨æ¥å°†å­—ç¬¦çš„ä¸åŒè¡¨ç¤ºæ–¹æ³•ç»Ÿä¸€ä¸ºåŒæ ·çš„å½¢å¼ï¼Œè¿™ç§°ä¸º Unicode æ­£è§„åŒ–ã€‚

5. **å®ä¾‹æ–¹æ³•`includes() startsWith() endsWith()`**

6. **å®ä¾‹æ–¹æ³•`repeat()`**

7. **å®ä¾‹æ–¹æ³•`padStart() padEnd()`**ï¼šå¼•å…¥äº†å­—ç¬¦ä¸²è¡¥å…¨é•¿åº¦çš„åŠŸèƒ½ã€‚

   ```javascript
   // å¸¸è§ç”¨é€”æ˜¯ä¸ºæ•°å€¼è¡¥å…¨æŒ‡å®šä½æ•°
   '1'.padStart(10, '0') // "0000000001"
   '12'.padStart(10, '0') // "0000000012"
   '123456'.padStart(10, '0') // "0000123456"
   
   // å¦ä¸€ä¸ªç”¨é€”æ˜¯æç¤ºå­—ç¬¦ä¸²æ ¼å¼
   '12'.padStart(10, 'YYYY-MM-DD') // "YYYY-MM-12"
   '09-12'.padStart(10, 'YYYY-MM-DD') // "YYYY-09-12"
   ```

8. **å®ä¾‹æ–¹æ³•`trimStart() trimEnd()`**
9. **å®ä¾‹æ–¹æ³•`matchAll() replaceAll()`**



## æ­£åˆ™çš„æ‰©å±•

> https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions



### å„ç§ä¿®é¥°ç¬¦

ES6 ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ–°å¢äº†`flags`å±æ€§ï¼Œä¼šè¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ã€‚

```javascript
// ES5 çš„ source å±æ€§ï¼š è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„æ­£æ–‡
/abc/ig.source
// "abc"

// ES6 çš„ flags å±æ€§ï¼šè¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦
/abc/ig.flags
// 'gi'

/hello\d/y.sticky	// true
/hello/u.unicode	// true
```



1. **uä¿®é¥°ç¬¦**ï¼šå«ä¹‰ä¸ºâ€œUnicode æ¨¡å¼â€ï¼Œç”¨æ¥æ­£ç¡®å¤„ç†å¤§äº`\uFFFF`çš„ Unicode å­—ç¬¦ã€‚

2. **yä¿®é¥°ç¬¦**ï¼šé¦–å…ˆ`g`ä¿®é¥°ç¬¦æ˜¯ä»å¤´å¼€å§‹å‘åæœç´¢ï¼Œç›´åˆ°å‘ç°åŒ¹é…ä¸ºæ­¢ã€‚è€Œ`y`ä¿®é¥°ç¬¦åˆ™æ˜¯ä»å¤´å¼€å§‹ï¼Œå¦‚æœå½“å‰ä¸åŒ¹é…åˆ™è¿”å›`null`ã€‚è¿™ç§°ä¸ºç²˜è¿æ¨¡å¼ã€‚å®ƒéœ€è¦ä¸`g`ä¿®é¥°ç¬¦è¿ç”¨ï¼Œå¦åˆ™åªä¼šåŒ¹é…ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚

3. **sä¿®é¥°ç¬¦**ï¼š`dotAll`æ¨¡å¼ï¼Œå³ç‚¹ï¼ˆdotï¼‰ä»£è¡¨ä¸€åˆ‡å­—ç¬¦ã€‚

   - æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç‚¹ï¼ˆ`.`ï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªä¾‹å¤–ï¼›<br>ä¸€ä¸ªæ˜¯å››ä¸ªå­—èŠ‚çš„ UTF-16 å­—ç¬¦ï¼Œè¿™ä¸ªå¯ä»¥ç”¨`u`ä¿®é¥°ç¬¦è§£å†³ï¼›<br>å¦ä¸€ä¸ªæ˜¯è¡Œç»ˆæ­¢ç¬¦ï¼šæ¢è¡Œç¬¦ã€å›è½¦ç¬¦ã€è¡Œåˆ†éš”ç¬¦ã€æ®µåˆ†éš”ç¬¦
   ```javascript
   /foo.bar/s.test('foo\nbar') // true
   ```



### Unicode å±æ€§ç±»

å…è®¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç¬¦åˆ Unicode æŸç§å±æ€§çš„æ‰€æœ‰å­—ç¬¦ã€‚

- Unicode å±æ€§ç±»è¦æŒ‡å®šå±æ€§åå’Œå±æ€§å€¼ã€‚å¯¹äºæŸäº›å±æ€§ï¼Œå¯ä»¥åªå†™å±æ€§åï¼Œæˆ–è€…åªå†™å±æ€§å€¼ã€‚
- `\P{â€¦}`æ˜¯`\p{â€¦}`çš„åå‘åŒ¹é…ï¼Œå³åŒ¹é…ä¸æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ã€‚
- è¿™ä¸¤ç§ç±»åªå¯¹ Unicode æœ‰æ•ˆï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦åŠ ä¸Š`u`ä¿®é¥°ç¬¦ã€‚

```javascript
const regexGreekSymbol = /\p{Script=Greek}/u;
regexGreekSymbol.test('Ï€') // true

const regex = /^\p{Decimal_Number}+$/u;
regex.test('ğŸğŸğŸ‘ğŸœğŸğŸğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸºğŸ»ğŸ¼') // true

// åŒ¹é…æ‰€æœ‰æ•°å­—
const regex = /^\p{Number}+$/u;
regex.test('Â²Â³Â¹Â¼Â½Â¾') // true
regex.test('ã‰›ã‰œã‰') // true
regex.test('â… â…¡â…¢â…£â…¤â…¥â…¦â…§â…¨â…©â…ªâ…«') // true

// åŒ¹é…æ‰€æœ‰ç©ºæ ¼
\p{White_Space}
// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰å­—æ¯ï¼Œç­‰åŒäº Unicode ç‰ˆçš„ \w
[\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]
// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰éå­—æ¯çš„å­—ç¬¦ï¼Œç­‰åŒäº Unicode ç‰ˆçš„ \W
[^\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]
// åŒ¹é… Emoji
/\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F/gu

// åŒ¹é…æ‰€æœ‰çš„ç®­å¤´å­—ç¬¦
const regexArrows = /^\p{Block=Arrows}+$/u;
regexArrows.test('â†â†‘â†’â†“â†”â†•â†–â†—â†˜â†™â‡â‡â‡‘â‡’â‡“â‡”â‡•â‡–â‡—â‡˜â‡™â‡§â‡©') // true
```



### å…·åç»„åŒ¹é…

åŸæœ‰ç»„åŒ¹é…çš„ä½¿ç”¨æ–¹æ³•ï¼š

```javascript
const RE_DATE = /(\d{4})-(\d{2})-(\d{2})/;

const matchObj = RE_DATE.exec('1999-12-31');
const year = matchObj[1]; // 1999
const month = matchObj[2]; // 12
const day = matchObj[3]; // 31
```

ES2018 å¼•å…¥äº†**å…·åç»„åŒ¹é…**ï¼Œå…è®¸ä¸ºæ¯ä¸€ä¸ªç»„åŒ¹é…æŒ‡å®šä¸€ä¸ªåå­—ï¼Œæ—¢ä¾¿äºé˜…è¯»ä»£ç ï¼Œåˆä¾¿äºå¼•ç”¨ã€‚

â€œå…·åç»„åŒ¹é…â€åœ¨åœ†æ‹¬å·å†…éƒ¨ï¼Œæ¨¡å¼çš„å¤´éƒ¨æ·»åŠ â€œ**é—®å· + å°–æ‹¬å· + ç»„å**â€ï¼ˆ`?<year>`ï¼‰ï¼Œç„¶åå°±å¯ä»¥åœ¨`exec`æ–¹æ³•è¿”å›ç»“æœçš„`groups`å±æ€§ä¸Šå¼•ç”¨è¯¥ç»„åã€‚åŒæ—¶ï¼Œæ•°å­—åºå·ï¼ˆ`matchObj[1]`ï¼‰ä¾ç„¶æœ‰æ•ˆã€‚

```javascript
const RE_DATE = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/;

const matchObj = RE_DATE.exec('1999-12-31');
const year = matchObj.groups.year; // "1999"
const month = matchObj.groups.month; // "12"
const day = matchObj.groups.day; // "31"
```



#### è§£æ„èµ‹å€¼å’Œæ›¿æ¢

1. æœ‰äº†å…·åç»„åŒ¹é…ä»¥åï¼Œå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ç›´æ¥ä»åŒ¹é…ç»“æœä¸Šä¸ºå˜é‡èµ‹å€¼ã€‚

    ```javascript
    let {groups: {one, two}} = /^(?<one>.*):(?<two>.*)$/u.exec('foo:bar');
    one  // foo
    two  // bar
    ```

2. å­—ç¬¦ä¸²æ›¿æ¢æ—¶ï¼Œä½¿ç”¨`$<ç»„å>`å¼•ç”¨å…·åç»„ã€‚

    ```javascript
    let re = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/u;

    '2015-01-02'.replace(re, '$<day>/$<month>/$<year>')
    // '02/01/2015'
    ```

    ä¸Šé¢ä»£ç ä¸­ï¼Œ`replace`æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚

    `replace`æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å‚æ•°åºåˆ—å¦‚ä¸‹ã€‚

    ```javascript
    '2015-01-02'.replace(re, (
       matched, // æ•´ä¸ªåŒ¹é…ç»“æœ 2015-01-02
       capture1, // ç¬¬ä¸€ä¸ªç»„åŒ¹é… 2015
       capture2, // ç¬¬äºŒä¸ªç»„åŒ¹é… 01
       capture3, // ç¬¬ä¸‰ä¸ªç»„åŒ¹é… 02
       position, // åŒ¹é…å¼€å§‹çš„ä½ç½® 0
       S, // åŸå­—ç¬¦ä¸² 2015-01-02
       groups // å…·åç»„æ„æˆçš„ä¸€ä¸ªå¯¹è±¡ {year, month, day}
     ) => {
     let {day, month, year} = groups;
     return `${day}/${month}/${year}`;
    });
    ```

    å…·åç»„åŒ¹é…åœ¨åŸæ¥çš„åŸºç¡€ä¸Šï¼Œæ–°å¢äº†æœ€åä¸€ä¸ªå‡½æ•°å‚æ•°ï¼šå…·åç»„æ„æˆçš„ä¸€ä¸ªå¯¹è±¡ã€‚å‡½æ•°å†…éƒ¨å¯ä»¥ç›´æ¥å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œè§£æ„èµ‹å€¼ã€‚



#### å¼•ç”¨

å¦‚æœè¦åœ¨æ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨å¼•ç”¨æŸä¸ªâ€œå…·åç»„åŒ¹é…â€ï¼Œå¯ä»¥ä½¿ç”¨`\k<ç»„å>`çš„å†™æ³•ã€‚

```javascript
const RE_TWICE = /^(?<word>[a-z]+)!\k<word>$/;
RE_TWICE.test('abc!abc') // true
RE_TWICE.test('abc!ab') // false
```

æ•°å­—å¼•ç”¨ï¼ˆ`\1`ï¼‰ä¾ç„¶æœ‰æ•ˆã€‚

```javascript
const RE_TWICE = /^(?<word>[a-z]+)!\1$/;
RE_TWICE.test('abc!abc') // true
RE_TWICE.test('abc!ab') // false
```

è¿™ä¸¤ç§å¼•ç”¨è¯­æ³•è¿˜å¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚

```javascript
const RE_TWICE = /^(?<word>[a-z]+)!\k<word>!\1$/;
RE_TWICE.test('abc!abc!abc') // true
RE_TWICE.test('abc!abc!ab') // false
```



### å…¶ä»–

1. æ”¯æŒåè¡Œæ–­è¨€ï¼š

   ```javascript
   // å…ˆè¡Œæ–­è¨€
   /\d+(?=%)/.exec('100% of US presidents have been male');  // ["100"]
   /\d+(?!%)/.exec('thatâ€™s all 44 of them');                 // ["44"]
   
   // åè¡Œæ–­è¨€
   /(?<=\$)\d+/.exec('Benjamin Franklin is on the $100 bill');  // ["100"]
   /(?<!\$)\d+/.exec('itâ€™s is worth about â‚¬90');                // ["90"]
   ```

2. `matchAll`

   - åŸæœ‰æ­£åˆ™åŒ¹é…å…¨å±€åº”ä½¿ç”¨`g`ï¼Œå¹¶ç”¨å¾ªç¯å–å¾—ç»“æœ`while (match = regex.exec(string))`

   - [ES2020](https://github.com/tc39/proposal-string-matchall) å¢åŠ äº†`String.prototype.matchAll()`æ–¹æ³•ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰åŒ¹é…ã€‚ä¸è¿‡ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªéå†å™¨ï¼ˆIteratorï¼‰ï¼Œè€Œä¸æ˜¯æ•°ç»„ã€‚

     ```javascript
     const string = 'test1test2test3';
     const regex = /t(e)(st(\d?))/g;
     
     for (const match of string.matchAll(regex)) {
       console.log(match);
     }
     // ["test1", "e", "st1", "1", index: 0, input: "test1test2test3"]
     // ["test2", "e", "st2", "2", index: 5, input: "test1test2test3"]
     // ["test3", "e", "st3", "3", index: 10, input: "test1test2test3"]
     
     // è½¬ä¸ºæ•°ç»„çš„æ–¹æ³•ä¸€
     [...string.matchAll(regex)]
     
     // è½¬ä¸ºæ•°ç»„çš„æ–¹æ³•äºŒ
     Array.from(string.matchAll(regex))
     ```



## æ•°å€¼çš„æ‰©å±•

æ­¤å¤„å†…å®¹å¤§å¤šç”¨ä¸åˆ°ï¼Œæ•…ç®€å†™ã€‚

1. **æŒ‡æ•°è¿ç®—ç¬¦ï¼ˆ`**`ï¼‰**
2. **BigInt**ï¼šBigInt åªç”¨æ¥è¡¨ç¤ºæ•´æ•°ï¼Œæ²¡æœ‰ä½æ•°çš„é™åˆ¶ï¼Œä»»ä½•ä½æ•°çš„æ•´æ•°éƒ½å¯ä»¥ç²¾ç¡®è¡¨ç¤ºã€‚å­—é¢é‡å¿…é¡»æ·»åŠ åç¼€`n`ã€‚



## å‡½æ•°çš„æ‰©å±•

1. **é»˜è®¤å‚æ•°**ï¼šé»˜è®¤å‚æ•°<u>æƒ°æ€§æ±‚å€¼</u>ï¼›è¿˜å¯ä¸è§£æ„èµ‹å€¼æ­é…ï¼›å‡½æ•°çš„`length`å±æ€§è¿”å›æ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼çš„å‚æ•°ä¸ªæ•°
2.  **rest å‚æ•°**ï¼šè·å–å‡½æ•°çš„å¤šä½™å‚æ•°ï¼Œä¾‹ï¼š`function add(...xs)`ã€‚åŒæ—¶å®ƒåªèƒ½æ˜¯æœ€åä¸€ä¸ªå‚æ•°ã€‚
3. **name å±æ€§**ï¼šè¿”å›è¯¥å‡½æ•°çš„å‡½æ•°åã€‚æ³¨æ„åŒ¿åå‡½æ•°åˆ™è¿”å›å¯¹åº”çš„å˜é‡åã€‚
4. **å°¾è°ƒç”¨ä¼˜åŒ–ï¼ˆè°ƒç”¨æ ˆå¤ç”¨ï¼‰**ï¼šå°¾è°ƒç”¨ç”±äºæ˜¯å‡½æ•°çš„æœ€åä¸€æ­¥æ“ä½œï¼Œæ‰€ä»¥ä¸éœ€è¦ä¿ç•™å¤–å±‚å‡½æ•°çš„è°ƒç”¨å¸§ï¼Œåªè¦ç›´æ¥ç”¨å†…å±‚å‡½æ•°çš„è°ƒç”¨å¸§ï¼Œå–ä»£å¤–å±‚å‡½æ•°çš„è°ƒç”¨å¸§å°±å¯ä»¥äº†ã€‚ES6 çš„å°¾è°ƒç”¨ä¼˜åŒ–åªåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å¼€å¯ã€‚
5. **catchè¯­å¥å‚æ•°çœç•¥**ï¼šå¾ˆå¤šæ—¶å€™ï¼Œ`catch`ä»£ç å—å¯èƒ½ç”¨ä¸åˆ°è¿™ä¸ªæŠ¥é”™å‚æ•°ã€‚



### ç®­å¤´å‡½æ•°

1. ç”±äºå¤§æ‹¬å·è¢«è§£é‡Šä¸ºä»£ç å—ï¼Œæ‰€ä»¥å¦‚æœç®­å¤´å‡½æ•°ç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»åœ¨å¯¹è±¡å¤–é¢åŠ ä¸Šæ‹¬å·ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
2. ç®­å¤´å‡½æ•°å¯ä»¥ä¸å˜é‡è§£æ„ç»“åˆä½¿ç”¨ã€‚
3. å¦‚æœå‡½æ•°ä½“å¾ˆå¤æ‚ï¼Œæœ‰è®¸å¤šè¡Œï¼Œæˆ–è€…å‡½æ•°å†…éƒ¨æœ‰å¤§é‡çš„è¯»å†™æ“ä½œï¼Œä¸å•çº¯æ˜¯ä¸ºäº†è®¡ç®—å€¼ï¼Œè¿™æ—¶ä¹Ÿä¸åº”è¯¥ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œè€Œæ˜¯è¦ä½¿ç”¨æ™®é€šå‡½æ•°ï¼Œè¿™æ ·å¯ä»¥æé«˜ä»£ç å¯è¯»æ€§ã€‚



**æ³¨æ„**ï¼š

ç®­å¤´å‡½æ•°é‡Œé¢æ ¹æœ¬æ²¡æœ‰è‡ªå·±çš„`this`ï¼Œè€Œæ˜¯**å¼•ç”¨å¤–å±‚<u>ä»£ç å—</u>çš„`this`**ã€‚ç®­å¤´å‡½æ•°è®©`this`æŒ‡å‘å›ºå®šåŒ–ï¼Œä»åŠ¨æ€å˜ä¸ºé™æ€ã€‚

- ï¼ˆåœ¨ JavaScript ä¸­ï¼Œå‡½æ•°æ˜¯å¯¹è±¡çš„æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ä¸æ˜¯ JavaScript å¯¹è±¡çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å…¨å±€å¯¹è±¡çš„å‡½æ•°ã€‚`call`æ–¹æ³•æ˜¯æŒ‡å‡½æ•°ä½œç”¨ä¸æŸä¸ªæŒ‡å®šå¯¹è±¡ä¸Šã€‚ï¼‰

- æ‰€ä»¥ï¼Œç®­å¤´å‡½æ•°è½¬æˆ ES5 çš„ä»£ç å¦‚ä¸‹ã€‚

  ```javascript
  // ES6
  function foo() {
    setTimeout(() => {
      console.log('id:', this.id);
    }, 100);
  }
  
  // ES5
  function foo() {
    var _this = this;
  
    setTimeout(function () {
      console.log('id:', _this.id);
    }, 100);
  }
  ```



è¿™å¯¼è‡´äº†ï¼š

1. **ä¸å¯ä»¥å½“ä½œæ„é€ å‡½æ•°**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯ä»¥ä½¿ç”¨`new`å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚
2. ä¸å¯ä»¥ä½¿ç”¨`arguments`å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨å‡½æ•°ä½“å†…ä¸å­˜åœ¨ã€‚å¦‚æœè¦ç”¨ï¼Œå¯ä»¥ç”¨ rest å‚æ•°ä»£æ›¿ã€‚
3. ä¸å¯ä»¥ä½¿ç”¨`yield`å‘½ä»¤ï¼Œå› æ­¤ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œ Generator å‡½æ•°ã€‚



## æ•°ç»„çš„æ‰©å±•

1. **å±•å¼€è¿ç®—ç¬¦**ï¼šå±•å¼€æ•°ç»„ï¼ˆIteratoræ¥å£å¯¹è±¡ï¼‰è½¬ä¸ºç”¨é€—å·åˆ†éš”çš„å‚æ•°åºåˆ—ã€‚ä»…ç”¨äº<u>å‡½æ•°è°ƒç”¨</u>å’Œ<u>æ•°ç»„ä¸­å±•å¼€</u>ã€‚ä¸‹é¢ç»™å‡ºä¸€äº›ä¾‹å­ã€‚

   ```javascript
   // 1. æ•°ç»„æµ…æ‹·è´
   const a1 = [1, 2];
   // å†™æ³•ä¸€
   const a2 = [...a1];
   // å†™æ³•äºŒ
   const [...a2] = a1;
   
   // 2. åˆå¹¶æ•°ç»„
   [...arr1, ...arr2, ...arr3]
   
   // 3. è§£æ„èµ‹å€¼
   const [first, ...tail] = [1, 2, 3, 4, 5];
   
   // 4. åˆ†è§£ unicode å­—ç¬¦ä¸²
   str.split('').reverse().join('')
   // 'y\uDE80\uD83Dx'
   
   [...str].reverse().join('')
   // 'y\uD83D\uDE80x'
   ```

2. **`Array.from`æ–¹æ³•**ï¼šç”¨äºå°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼šç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆarray-like objectï¼‰å’Œå¯éå†ï¼ˆiterableï¼‰çš„å¯¹è±¡ã€‚

   - ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡å®ç°äº†`ArrayLike`æ¥å£

       ```typescript
       interface ArrayLike<T> {
           readonly length: number;
           readonly [n: number]: T;
       }
       ```

   - å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œä½œç”¨ç±»ä¼¼äºæ•°ç»„çš„`map`æ–¹æ³•ï¼Œç”¨æ¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå°†å¤„ç†åçš„å€¼æ”¾å…¥è¿”å›çš„æ•°ç»„ã€‚
   
3. **`Array.of`æ–¹æ³•**ï¼šç”¨äºå°†ä¸€ç»„å€¼ï¼Œè½¬æ¢ä¸ºæ•°ç»„ã€‚ç”¨äºæ›¿æ¢æ··ä¹±çš„åŸæœ‰æ„é€ æ–¹æ³•ã€‚

4. å®ä¾‹æ–¹æ³•**`find`  å’Œ `findIndex`**ï¼šæ¥å—å‡½æ•°ï¼Œè¿”å›é‡åˆ°çš„ç¬¬ä¸€ä¸ªå€¼æˆ–ç´¢å¼•ã€‚

5. **å®ä¾‹æ–¹æ³•`flat`å’Œ`flatMap`**

6. `sort()`çš„é»˜è®¤æ’åºç®—æ³•æ˜¯<u>ç¨³å®š</u>çš„

7. å®ä¾‹æ–¹æ³•`fill`

8. å®ä¾‹æ–¹æ³•`entries` `keys` `values`ï¼šè¿”å›Iteratorå¯¹è±¡



## å¯¹è±¡çš„æ‰©å±•

1. **å±æ€§å’Œæ–¹æ³•çš„ç®€æ´è¡¨ç¤ºæ³•**ï¼šå…è®¸åœ¨å¤§æ‹¬å·é‡Œé¢ï¼Œç›´æ¥å†™å…¥å˜é‡å’Œå‡½æ•°ï¼Œä½œä¸ºå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚

   ```javascript
   const foo = "foo";
   const o = {
     foo,
     method() {
       return "Hello!";
     }
   };
   ```

2. **å±æ€§åè¡¨è¾¾å¼**ï¼šç”¨è¡¨è¾¾å¼ä½œä¸ºå±æ€§åï¼Œè¿™æ—¶è¦å°†è¡¨è¾¾å¼æ”¾åœ¨æ–¹æ‹¬å·ä¹‹å†…ã€‚

   ```javascript
   let propKey = 'foo';
   let obj = {
     [propKey]: true,
     ['a' + 'bc']: 123
   };
   ```



### å¤ä¹ å¯¹è±¡

#### æ„é€ å‡½æ•°

ä¸ºäº†æä¾›ä¸€ä¸ªä¾¿æ·çš„æ„é€ æ–¹æ³•ï¼Œä½¿ç”¨`this`å’Œ`new`å¹¶ä¸è®¾ç½®è¿”å›å€¼ï¼š

```javascript
function Person(name) {
  this.name = name;
  this.greeting = function() {
    alert('Hi! I\'m ' + this.name + '.');
  };
}

const p = new Person("foo");
```



##### å…¶ä»–æ–¹å¼

1. è¿˜å¯ä»¥å°†å¯¹è±¡æ–‡æœ¬ä¼ é€’ç»™**Object()** æ„é€ å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œ ä»¥ä¾¿ç”¨å±æ€§/æ–¹æ³•å¡«å……å®ƒã€‚è¯·å°è¯•ä»¥ä¸‹æ“ä½œï¼š  

    ```javascript
    var person1 = new Object({
      name : 'Chris',
      age : 38,
      greeting : function() {
        alert('Hi! I\'m ' + this.name + '.');
      }
    });
    ```

2. JavaScriptæœ‰ä¸ªå†…åµŒçš„æ–¹æ³•`create()`, å®ƒå…è®¸æ‚¨åŸºäºåŸå‹é“¾å¯¹ç°æœ‰å¯¹è±¡åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚  

   ```javascript
   var person2 = Object.create(person1);
   person2.__proto__ === person1
   ```



#### åŸå‹é“¾

1. **åŸå‹**ï¼šæ¯ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ª**åŸå‹å¯¹è±¡**ï¼Œå¯¹è±¡ä»¥å…¶åŸå‹ä¸ºæ¨¡æ¿ã€ä»åŸå‹ç»§æ‰¿æ–¹æ³•å’Œå±æ€§ã€‚åŸå‹å¯¹è±¡ä¹Ÿå¯èƒ½æ‹¥æœ‰åŸå‹ï¼Œå¹¶ä»ä¸­ç»§æ‰¿æ–¹æ³•å’Œå±æ€§ï¼Œä¸€å±‚ä¸€å±‚ã€ä»¥æ­¤ç±»æ¨ã€‚

2. **åŸå‹é“¾**ï¼šè¿™ç§å…³ç³»å¸¸è¢«ç§°ä¸º**åŸå‹é“¾ (prototype chain)**ï¼Œå®ƒè§£é‡Šäº†ä¸ºä½•ä¸€ä¸ªå¯¹è±¡ä¼šæ‹¥æœ‰å®šä¹‰åœ¨å…¶ä»–å¯¹è±¡ä¸­çš„å±æ€§å’Œæ–¹æ³•ã€‚

3. æ¯ä¸ªå®ä¾‹è®¿é—®å±æ€§çš„è¿‡ç¨‹ï¼Œç±»ä¼¼ä¸<u>è‡ªåŠ¨è§£å¼•ç”¨</u>ã€‚

   

##### ä¸¾ä¾‹

```javascript
// é™¤äº†ç®­å¤´å‡½æ•°ä»¥å¤–ï¼Œéƒ½å¯ä»¥ä½œä¸ºæ„é€ å‡½æ•°
let Cons = function(){};
let Ins = new doSomething()

console.assert( Ins.__proto__ === Cons.prototype )
console.assert( Ins.__proto__.proto === Object.prototype )
console.assert( Cons.__proto__ === Function.prototype )
```

![prototype_chain](/static/image/2021-01-16/prototype_chain.png)

- **æ„é€ å‡½æ•°**ï¼šæ‹¥æœ‰`prototype`å’Œ`__proto__`
- **åŸå‹**ï¼šæ‹¥æœ‰`__proto__`ã€`constructor`å’Œ<u>è‡ªå®šä¹‰çš„å±æ€§</u>ï¼›ä½†æ³¨æ„`Object.prototype.__proto`ä¸º`null`
- **å®ä¾‹**ï¼šæ‹¥æœ‰`__proto__`



**æ³¨æ„**

- åœ¨æ„é€ å‡½æ•°ä¸­å¯¹`this`æ·»åŠ å±æ€§æ—¶ï¼Œå®ƒä¼šéšç€`new`è€Œå‡ºç°åœ¨å®ä¾‹å¯¹è±¡çš„å±æ€§ä¸Šã€‚**æ‰€ä»¥å®ƒä¸åœ¨åŸå‹é“¾ä¸Šï¼Œä¸è¢«ç»§æ‰¿ã€‚**

- åœ¨æ„é€ å‡½æ•°çš„åŸå‹ä¸Šæ·»åŠ å±æ€§æ—¶ï¼Œå®ƒä¼šè¢«æ·»åŠ åœ¨åŸå‹ä¸Šï¼Œåœ¨å®ä¾‹è®¿é—®æ—¶â€œè‡ªåŠ¨è§£å¼•ç”¨â€ã€‚

  ```javascript
  function Person() {
    this.name = 'Chris';
    this.age = 38;
    this.greeting = function() {
      alert('Hi! I\'m ' + this.name + '.');
    };
  }
  
  Person.prototype.hello = function() {
    console.log("hello");
  }
  
  console.log(new Person())
  // {
  //   age: 38,
  //   greeting: function greeting(),
  //   name: "Chris",
  //   __proto__: {
  //     hello: hello(),
  //     ...
  //   },
  // }
  ```

  

#### åŸå‹é“¾ç»§æ‰¿ / å§”æ‰˜

- `this`å¯¹åº”çš„å±æ€§ï¼Œåªæœ‰å½“`new`è¯­å¥ä½œç”¨æ—¶ï¼Œæ‰ç”Ÿæˆå‡ºæ¥ä½œä¸º**å®ä¾‹çš„å±æ€§**ã€‚

- **åŸå‹é“¾ç»§æ‰¿çš„æ­¥éª¤**
  1. æ„é€ å‡½æ•°ä¸­ä½¿ç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œä½œç”¨äºå½“å‰çš„`this`
  2. å­ç±»çš„åŸå‹å…³è”çˆ¶ç±»çš„åŸå‹ï¼Œä½¿ç”¨`Object.create()`
  3. è®¾ç½®å­ç±»åŸå‹çš„æ„é€ å‡½æ•°

```javascript
// Person
function Person(first, last, age, gender, interests) {
  this.name = { first, last };
  this.age = age;
  this.gender = gender;
  this.interests = interests;
}

Person.prototype.greeting = function() {
  alert('Hi! I\'m ' + this.name.first + '.');
};


// Teacher
function Teacher(first, last, age, gender, interests, subject) {
  // 1. call æŒ‡æ˜äº†åœ¨è¿è¡Œè¿™ä¸ªå‡½æ•°æ—¶æƒ³å¯¹â€œthisâ€æŒ‡å®šçš„å€¼ 
  Person.call(this, first, last, age, gender, interests);

  this.subject = subject;
}

// 2. å…³è”åŸå‹ï¼Œå¹¶ä¸”è®¾ç½®æ„é€ å‡½æ•°
Teacher.prototype = Object.create(Person.prototype);
Teacher.prototype.constructor = Teacher;
```





### å¯¹è±¡çš„å¯æšä¸¾æ€§

å¯¹è±¡çš„æ¯ä¸ªå±æ€§éƒ½æœ‰ä¸€ä¸ª**æè¿°å¯¹è±¡**ï¼ˆDescriptorï¼‰ï¼Œç”¨æ¥æ§åˆ¶è¯¥å±æ€§çš„è¡Œä¸ºã€‚`Object.getOwnPropertyDescriptor`æ–¹æ³•å¯ä»¥è·å–è¯¥å±æ€§çš„æè¿°å¯¹è±¡ã€‚

```javascript
let obj = { foo: 123 };
Object.getOwnPropertyDescriptor(obj, 'foo')
//  {
//    value: 123,
//    writable: true,
//    enumerable: true,
//    configurable: true
//  }
```

æè¿°å¯¹è±¡çš„`enumerable`å±æ€§ï¼Œç§°ä¸ºâ€œå¯æšä¸¾æ€§â€ï¼Œå¦‚æœè¯¥å±æ€§ä¸º`false`ï¼Œå°±è¡¨ç¤ºæŸäº›æ“ä½œä¼šå¿½ç•¥å½“å‰å±æ€§ã€‚

ç›®å‰ï¼Œæœ‰å››ä¸ªæ“ä½œä¼šå¿½ç•¥`enumerable`ä¸º`false`çš„å±æ€§ã€‚

- `for...in`å¾ªç¯ï¼šåªéå†å¯¹è±¡è‡ªèº«çš„å’Œç»§æ‰¿çš„å¯æšä¸¾çš„å±æ€§ã€‚
- `Object.keys()`ï¼šè¿”å›å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰å¯æšä¸¾çš„å±æ€§çš„é”®åã€‚
- `JSON.stringify()`ï¼šåªä¸²è¡ŒåŒ–å¯¹è±¡è‡ªèº«çš„å¯æšä¸¾çš„å±æ€§ã€‚
- `Object.assign()`ï¼š å¿½ç•¥`enumerable`ä¸º`false`çš„å±æ€§ï¼Œåªæ‹·è´å¯¹è±¡è‡ªèº«çš„å¯æšä¸¾çš„å±æ€§ã€‚

å…¶ä¸­ï¼Œåªæœ‰`for...in`ä¼šè¿”å›ç»§æ‰¿çš„å±æ€§ï¼Œå…¶ä»–ä¸‰ä¸ªæ–¹æ³•éƒ½ä¼šå¿½ç•¥ç»§æ‰¿çš„å±æ€§ï¼Œåªå¤„ç†å¯¹è±¡è‡ªèº«çš„å±æ€§ã€‚



### å…¶ä»–

- `super`å…³é”®å­—ï¼š`super === this.__proto__`æˆ–è€…`super === Object.getPrototype(this)`

- **å±•å¼€è¿ç®—ç¬¦çš„è§£æ„èµ‹å€¼**ï¼šæ³¨æ„ï¼Œ**è§£æ„èµ‹å€¼çš„æ‹·è´æ˜¯æµ…æ‹·è´**

  ```javascript
  let { x, y, ...z } = { x: 1, y: 2, a: 3, b: 4 };
  x // 1
  y // 2
  z // { a: 3, b: 4 }
  ```

- **é“¾åˆ¤æ–­è¿ç®—ç¬¦**ï¼šåˆ¤æ–­å·¦ä¾§çš„å¯¹è±¡æ˜¯å¦ä¸º`null`æˆ–`undefined`ã€‚æ˜¯åˆ™è¿”å›`undefined`ã€‚

  - é“¾åˆ¤æ–­è¿ç®—ç¬¦æœ‰ä¸‰ç§ç”¨æ³•:`obj?.prop`ã€`obj?.[expr]`ã€`func?.(...args)` 

  ```javascript
  const firstName = message?.body?.user?.firstName || 'default';
  const fooValue = myForm.querySelector('input[name=foo]')?.value
  const result = it.func?.()
  ```

- **Null åˆ¤æ–­è¿ç®—ç¬¦**ï¼š

  - è¯»å–å¯¹è±¡å±æ€§çš„æ—¶å€™ï¼Œå¦‚æœæŸä¸ªå±æ€§çš„å€¼æ˜¯`null`æˆ–`undefined`ï¼Œæœ‰æ—¶å€™éœ€è¦ä¸ºå®ƒä»¬æŒ‡å®šé»˜è®¤å€¼ã€‚å¸¸è§åšæ³•æ˜¯é€šè¿‡`||`è¿ç®—ç¬¦æŒ‡å®šé»˜è®¤å€¼ã€‚<u>ä½†æ˜¯å±æ€§çš„å€¼å¦‚æœä¸ºç©ºå­—ç¬¦ä¸²æˆ–`false`æˆ–`0`ï¼Œé»˜è®¤å€¼ä¹Ÿä¼šç”Ÿæ•ˆã€‚</u>

  - [ES2020](https://github.com/tc39/proposal-nullish-coalescing) å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ Null åˆ¤æ–­è¿ç®—ç¬¦`??`ã€‚å®ƒçš„è¡Œä¸ºç±»ä¼¼`||`ï¼Œä½†æ˜¯åªæœ‰è¿ç®—ç¬¦å·¦ä¾§çš„å€¼ä¸º`null`æˆ–`undefined`æ—¶ï¼Œæ‰ä¼šè¿”å›å³ä¾§çš„å€¼ã€‚

    ```javascript
    const headerText = response.settings.headerText ?? 'Hello, world!';
    ```



## Symbol

ES6 å¼•å…¥äº†ä¸€ç§æ–°çš„åŸå§‹æ•°æ®ç±»å‹`Symbol`ï¼Œè¡¨ç¤º**ç‹¬ä¸€æ— äºŒ**çš„å€¼ã€‚å‡¡æ˜¯å¯¹è±¡çš„å±æ€§åå±äº Symbol ç±»å‹ï¼Œå°±å¯ä»¥ä¿è¯ä¸ä¼šä¸å…¶ä»–å±æ€§åäº§ç”Ÿå†²çªã€‚

ï¼ˆå®ƒæ˜¯ JavaScript è¯­è¨€çš„ç¬¬ä¸ƒç§æ•°æ®ç±»å‹ï¼Œå‰å…­ç§æ˜¯ï¼š`undefined`ã€`null`ã€å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ã€å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€æ•°å€¼ï¼ˆNumberï¼‰ã€å¯¹è±¡ï¼ˆObjectï¼‰ã€‚ï¼‰

- **æè¿°**ï¼š`Symbol`å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºå¯¹ Symbol å®ä¾‹çš„æè¿°`sym.description`ã€‚ä¸ç®¡æä¾›ä¸æä¾›æè¿°ï¼Œ`Symbol`ä¹‹é—´éƒ½æ˜¯ä¸ç›¸ç­‰çš„ã€‚

  - å¦‚æœ Symbol çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¼šè°ƒç”¨è¯¥å¯¹è±¡çš„`toString`æ–¹æ³•ä½œä¸ºæè¿°ï¼Œç„¶åæ‰ç”Ÿæˆä¸€ä¸ª Symbol å€¼ã€‚

- **ç™»è®°æœºåˆ¶**ï¼š`Symbol.for()`ä¼šç”Ÿæˆæ–°çš„ Symbolï¼ŒåŒæ—¶ä¼šæŸ¥æ‰¾è¢«ç™»è®°åœ¨å…¨å±€ç¯å¢ƒä¸­çš„`Symbol`ã€‚`Symbol.keyFor()`æ–¹æ³•è¿”å›ä¸€ä¸ªå·²ç™»è®°çš„ Symbol ç±»å‹å€¼çš„`key`ã€‚

- **å¯¹è±¡å±æ€§çš„ç”¨é€”**ï¼šä¸‹é¢ç»™å‡ºä¸€äº›ç”¨é€”ã€‚

  - ç‹¬ä¸€æ— äºŒçš„å±æ€§åï¼Œèƒ½ä¿è¯ä¸ä¼šå‡ºç°åŒåçš„å±æ€§ï¼Œé˜²æ­¢æ”¹å†™æˆ–è¦†ç›–ã€‚

  - å®šä¹‰éç§æœ‰çš„ã€ä½†åˆå¸Œæœ›åªç”¨äºå†…éƒ¨çš„æ–¹æ³•ï¼š

    ```javascript
    let size = Symbol('size');
    
    class Collection {
      constructor() {
        this[size] = 0;
      }
    
      add(item) {
        this[this[size]] = item;
        this[size]++;
      }
    
      static sizeOf(instance) {
        return instance[size];
      }
    }
    
    let x = new Collection();
    Collection.sizeOf(x) // 0
    
    x.add('foo');
    Collection.sizeOf(x) // 1
    
    Object.keys(x) // ['0']
    Object.getOwnPropertyNames(x) // ['0']
    Object.getOwnPropertySymbols(x) // [Symbol(size)]
    ```
  
- **å†…ç½®æ–¹æ³•**ï¼šES6 è¿˜æä¾›äº† 11 ä¸ªå†…ç½®çš„ Symbol å€¼ï¼ŒæŒ‡å‘è¯­è¨€å†…éƒ¨ä½¿ç”¨çš„æ–¹æ³•ã€‚

  - `Symbol.hasInstance`ï¼šå½“å…¶ä»–å¯¹è±¡ä½¿ç”¨`instanceof`è¿ç®—ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºè¯¥å¯¹è±¡çš„å®ä¾‹æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚æ³¨æ„æä¾›æ­¤æ–¹æ³•æ—¶ä½¿ç”¨`static`ã€‚

  - `Symbol.species`ï¼šå®ä¾‹å¯¹è±¡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å†æ¬¡è°ƒç”¨è‡ªèº«çš„æ„é€ å‡½æ•°æ—¶ï¼Œä½¿ç”¨å®ƒå°±å¯ä»¥è°ƒç”¨è¯¥å±æ€§æŒ‡å®šçš„æ„é€ å‡½æ•°ã€‚

    ```javascript
    class MyArray extends Array {
      static get [Symbol.species]() { return Array; }
    }
    
    const a = new MyArray();
    const b = a.map(x => x);
    
    b instanceof MyArray // false
    b instanceof Array // true
    ```
    
  - `Symbol.match`ã€`Symbol.replace`ã€`Symbol.search`ã€`Symbol.split`ï¼šè¡¨ç¤ºä½¿ç”¨å¯¹åº”çš„å­—ç¬¦ä¸²å®ä¾‹æ–¹æ³•æ—¶ï¼Œè°ƒç”¨è¿™äº›å±æ€§çš„æ–¹æ³•ã€‚
  
  - `Symbol.iterator`ï¼šè¯¥å¯¹è±¡çš„é»˜è®¤éå†å™¨æ–¹æ³•ã€‚
  
  - `Symbol.toPrimitive`ï¼šè¯¥å¯¹è±¡è¢«è½¬ä¸ºåŸå§‹ç±»å‹çš„å€¼æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿”å›è¯¥å¯¹è±¡å¯¹åº”çš„åŸå§‹ç±»å‹å€¼ã€‚
  
  - `Symbol.toStringTag`ï¼šç”¨æ¥å®šåˆ¶`[object Object]`æˆ–`[object Array]`ä¸­`object`åé¢çš„é‚£ä¸ªå­—ç¬¦ä¸²ã€‚



## æ•°æ®ç»“æ„çš„æ‰©å±•



### Set

- `Set`å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªæ•°ç»„ï¼ˆæˆ–è€…å…·æœ‰ iterable æ¥å£çš„å…¶ä»–æ•°æ®ç»“æ„ï¼‰ä½œä¸ºå‚æ•°ï¼Œç”¨æ¥åˆå§‹åŒ–ã€‚
- Set å†…éƒ¨åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸åŒï¼Œä½¿ç”¨çš„ç®—æ³•å«åšâ€œ**Same-value-zero** equalityâ€ï¼Œå®ƒç±»ä¼¼äºç²¾ç¡®ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ`===`ï¼‰ï¼Œä¸»è¦çš„åŒºåˆ«æ˜¯å‘ Set åŠ å…¥å€¼æ—¶è®¤ä¸º`NaN`ç­‰äºè‡ªèº«ï¼Œè€Œç²¾ç¡®ç›¸ç­‰è¿ç®—ç¬¦è®¤ä¸º`NaN`ä¸ç­‰äºè‡ªèº«ã€‚



### WeakSet

- WeakSet çš„æˆå‘˜åªèƒ½æ˜¯å¯¹è±¡ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–ç±»å‹çš„å€¼ã€‚
- WeakSet ä¸­çš„å¯¹è±¡éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œéƒ½ä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚å¦‚æœå…¶ä»–å¯¹è±¡éƒ½ä¸å†å¼•ç”¨è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨å›æ”¶è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ï¼Œä¸è€ƒè™‘è¯¥å¯¹è±¡è¿˜å­˜åœ¨äº WeakSet ä¹‹ä¸­ã€‚å¸¸ç”¨äºå¼±ç›¸å…³çš„å¯¹è±¡é—´ï¼Œæ¯”å¦‚ä»…å½“Aå¯¹è±¡å­˜åœ¨æ—¶ï¼Œæ‰ä¼šè®¿é—®Bå¯¹è±¡ã€‚å¦‚æœåˆ é™¤å®ä¾‹ï¼Œå®ƒä»¬ä¹Ÿå°±éšä¹‹æ¶ˆå¤±ï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚



### Map

Object ç»“æ„æä¾›äº†â€œå­—ç¬¦ä¸²â€”å€¼â€çš„å¯¹åº”ï¼ŒMap ç»“æ„æä¾›äº†â€œå€¼â€”å€¼â€çš„å¯¹åº”ã€‚

- ä½œä¸ºæ„é€ å‡½æ•°ï¼ŒMap ä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªæ•°ç»„ï¼ˆä¸ä»…ä»…æ˜¯æ•°ç»„ï¼Œä»»ä½•å…·æœ‰ Iterator æ¥å£ã€ä¸”æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªåŒå…ƒç´ çš„æ•°ç»„çš„æ•°æ®ç»“æ„ï¼‰ä½œä¸ºå‚æ•°ã€‚è¯¥æ•°ç»„çš„æˆå‘˜æ˜¯ä¸€ä¸ªä¸ªè¡¨ç¤ºé”®å€¼å¯¹çš„æ•°ç»„ã€‚

- Map çš„è½¬æ¢

  ```javascript
  // Map è½¬ä¸ºå¯¹è±¡
  function strMapToObj(strMap) {
    let obj = Object.create(null);
    for (let [k,v] of strMap) {
      obj[k] = v;
    }
    return obj;
  }
  
  const myMap = new Map()
    .set('yes', true)
    .set('no', false);
  strMapToObj(myMap)
  // { yes: true, no: false }
  
  // ---
  // å¯¹è±¡è½¬ä¸º Map
  let obj = {"a":1, "b":2};
  let map = new Map(Object.entries(obj));
  
  // ---
  // Map è½¬ä¸º JSON
  function strMapToJson(strMap) {
    return JSON.stringify(strMapToObj(strMap));
  }
  function mapToArrayJson(map) {
    return JSON.stringify([...map]);
  }
  ```



### WeakMap

- `WeakMap`åªæ¥å—å¯¹è±¡ä½œä¸ºé”®å
- `WeakMap`çš„é”®åæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚å¸¸ç”¨äºå¼±ç›¸å…³çš„å¯¹è±¡é—´ï¼Œæ¯”å¦‚ä»…å½“Aå¯¹è±¡å­˜åœ¨æ—¶ï¼Œæ‰ä¼šè®¿é—®Bå¯¹è±¡ã€‚å¦‚æœåˆ é™¤å®ä¾‹ï¼Œå®ƒä»¬ä¹Ÿå°±éšä¹‹æ¶ˆå¤±ï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚



## Proxy & Reflect



### Proxy

Proxy å³ä»£ç†æ¨¡å¼ï¼Œåœ¨æ–¹æ³•å¤–å±‚è¿›è¡Œæ‹¦æˆªã€‚Proxy å®é™…ä¸Šé‡è½½äº†ç‚¹è¿ç®—ç¬¦ï¼Œå³ç”¨è‡ªå·±çš„å®šä¹‰è¦†ç›–äº†è¯­è¨€çš„åŸå§‹å®šä¹‰ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

```javascript
var proxy = new Proxy({}, {
  get: function(target, propKey) {
    return 35;
  }
});

proxy.time // 35
proxy.name // 35
proxy.title // 35
```

-  Proxy æ”¯æŒçš„æ‹¦æˆªæ“ä½œä¸€è§ˆï¼Œä¸€å…± 13 ç§ã€‚[å‚è€ƒ](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy)
- **åœºæ™¯**ï¼š
  - å®ç°æ•°æ®åº“çš„ ORM å±‚
  - è§‚å¯Ÿè€…æ¨¡å¼
  - æ•°æ®çš„åŒå‘ç»‘å®šï¼šå…ˆå‰ä½¿ç”¨`Object.defineProporty`é€’å½’é‡å†™å¯¹è±¡çš„å±æ€§çš„`set`å’Œ`get`æ–¹æ³•ï¼›ç°åœ¨ä½¿ç”¨`Proxy`èƒ½æ•è·æ›´å¤šçš„æ“ä½œã€‚



### Reflect

`Reflect`å¯¹è±¡ä¸`Proxy`å¯¹è±¡ä¸€æ ·ï¼Œä¹Ÿæ˜¯ ES6 ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–° APIã€‚

`Reflect`å¯¹è±¡çš„è®¾è®¡ç›®çš„æœ‰è¿™æ ·å‡ ä¸ªï¼š

- å°†`Object`å¯¹è±¡çš„ä¸€äº›æ˜æ˜¾å±äºè¯­è¨€å†…éƒ¨çš„æ–¹æ³•ï¼Œæ”¾åˆ°`Reflect`å¯¹è±¡ä¸Šã€‚
- ä¿®æ”¹æŸäº›`Object`æ–¹æ³•çš„è¿”å›ç»“æœï¼Œè®©å…¶å˜å¾—æ›´åˆç†ã€‚
-  è®©`Object`çš„æŸäº›è¯­æ³•ä¸Šçš„æ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸ºã€‚
- `Reflect`å¯¹è±¡çš„æ–¹æ³•ä¸`Proxy`å¯¹è±¡çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ã€‚

`Reflect`å¯¹è±¡ä¸€å…±æœ‰ 13 ä¸ªé™æ€æ–¹æ³•ï¼Œäº‹å®ä¸Šä¸ Proxy çš„å†…ç½®æ–¹æ³•çš„æ„å‘³ç›¸åŒã€‚



## Promise

Promise æ˜¯<u>å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆ</u>ï¼Œæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆï¼šå›è°ƒå‡½æ•°ã€äº‹ä»¶é©±åŠ¨ï¼Œæ›´åˆç†å’Œæ›´å¼ºå¤§ã€‚

- **å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“**ã€‚`Promise`å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š`pending`ï¼ˆè¿›è¡Œä¸­ï¼‰ã€`fulfilled`ï¼ˆå·²æˆåŠŸï¼‰å’Œ`rejected`ï¼ˆå·²å¤±è´¥ï¼‰ã€‚
- **ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜**ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å†å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚
- ç¼ºé™·ï¼š
  - æ— æ³•ä¸­é€”å–æ¶ˆ`Promise`ã€‚
  - å¤„äº`pending`çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µã€‚
- **æ³¨æ„**ï¼š`Promise.then`æ˜¯ä¸€ä¸ªå¾®ä»»åŠ¡ã€‚è¯¦è§<https://fourstacks.codes/node/>



### Monad

> https://zhuanlan.zhihu.com/p/260966706

è¿™é‡Œæä¸€ä¸‹ Monadï¼Œå®ƒæ˜¯æœ‰ä¸€ä¸ªå‡½æ•°`flatMap`æ„æˆçš„ä¸€ç§ç±»å‹ã€‚`flatMap`çš„å‡½æ•°ç­¾åæ˜¯`M a -> (a -> M b) -> M b`ã€‚

ä¸éš¾å‘ç° Promise çš„ `then`å‡½æ•°æ˜¯ä¸€ä¸ª `flatMap`ï¼Œæ‰€ä»¥ Promise æ˜¯ä¸€ä¸ª Monadã€‚å…³äº Monad çš„ä½œç”¨ï¼š

- Monad ä¸»è¦çš„ä½œç”¨æ˜¯æ¶ˆé™¤ IO çš„å‰¯ä½œç”¨ï¼Œå°† IO çš„å½±å“æ§åˆ¶åœ¨ Monad çš„èŒƒå›´å†…ã€‚
  - æ¯”å¦‚è¯»ç”¨æˆ·è¾“å…¥çš„æ“ä½œï¼Œ`getLine`è¿”å›çš„æ˜¯ä¸€ä¸ª IO Monadã€‚å¼€å‘è€…åªèƒ½ä½¿ç”¨`flatMap`å¯¹å†…å®¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œï¼ŒåŒæ—¶åªèƒ½è¿”å›å¦ä¸€ä¸ª Monadã€‚å°†åŠ¨ä½œéš”ç¦»åœ¨Monadçš„ä¸–ç•Œé‡Œï¼Œè¿™æ ·å°±ä¸ä¼šå°†å‰¯ä½œç”¨å¸¦å‡ºæ¥äº†ã€‚
- å¦ä¸€ä¸ªä½œç”¨æ˜¯ä½¿ç”¨ Monad å°†ä¼šå°‘å†™å¾ˆå¤šé€»è¾‘åˆ¤æ–­è¯­å¥ã€‚æ­¤å¤„è€ƒè™‘ Go è¯­è¨€å¤„ç†é”™è¯¯çš„æƒ…æ™¯ï¼ŒåŒæ—¶å¯¹æ¯” Rust å’Œ Haskell çš„åŒæ ·å†™æ³•ã€‚



åŒæ—¶æ³¨æ„ï¼Œç”±äº `Promise.prototype.then` æ˜¯ä¸€ä¸ª`flatMap`ï¼Œæ‰€ä»¥ä¸€å®šè¦æ³¨æ„å®ƒæ¥æ”¶çš„å‡½æ•°çš„ç­¾å`a -> M b`å’Œè¿”å›å€¼`M b`ã€‚åŒæ—¶ï¼Œå®ƒæ¥å—çš„å‡½æ•°çš„ç­¾åå´æ˜¯`a -> b`ï¼Œçœ‹æ¥`then`åº•å±‚å°è£…äº†åŒ…æ‹¬æŠ¥é”™åœ¨å†…çš„æ–¹æ³•ã€‚



### åŸºæœ¬ç”¨æ³•

```javascript
promise
.then(result => {Â·Â·Â·})
.catch(error => {Â·Â·Â·})
.finally(() => {Â·Â·Â·});
```

```javascript
const promise = new Promise(function(resolve, reject) {
  // ... some code

  if (/* æˆåŠŸ */){
    resolve(value);
  } else {
    reject(error);
  }
});


promise.then(function(value) {
  // success
}, function(error) {
  // failure
});


const p2 = new Promise(function (resolve, reject) {
  setTimeout(() => resolve(p1), 1000)
})

p2
  .then(result => console.log(result))
  .catch(error => console.log(error))
```

**æ³¨æ„**ï¼š

- **æ„é€ å‡½æ•°æ¥å—çš„å‡½æ•°**ï¼š
  - `resolve`å’Œ`reject`å‡½æ•°ï¼Œä¸è¦å†™ä¸¢ã€‚
  - è°ƒç”¨`resolve`æˆ–`reject`å¹¶ä¸ä¼šç»ˆç»“ Promise çš„å‚æ•°å‡½æ•°çš„æ‰§è¡Œã€‚
- **é”™è¯¯å¤„ç†**ï¼š
  - åœ¨æ„é€ å‡½æ•°æ¥å—çš„å‡½æ•°ä¸­ï¼ŒæŠ¥é”™å¯ä»¥é€šè¿‡`reject`ä¹Ÿå¯ä»¥é€šè¿‡`throw`ã€‚
  - Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª`catch`è¯­å¥æ•è·ã€‚
- **`then`æ–¹æ³•æ¥å—çš„å‡½æ•°**ï¼šæ˜¯ä¸€ä¸ª`a -> b`çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯`a -> M b`çš„å‡½æ•°ã€‚å®ƒçš„å®ç°ä¸Šè€ƒè™‘äº†æŠ¥é”™çš„é—®é¢˜ã€‚



### æ–°å¢æ–¹æ³•

- **`Promise.prototype.finally()`**ï¼šæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚æ³¨æ„å®ƒæ¥å—çš„å‡½æ•°æ²¡æœ‰å‚æ•°ã€‚

- å¤šä¸ª Promise åŒ…è£…æˆä¸€ä¸ª Promise çš„æ–¹æ³•ï¼š

  - `all`ï¼šç›¸å½“äº**and**ã€‚

    - å½“æ•°ç»„ä¸­çš„çŠ¶æ€éƒ½å˜æˆ`fulfilled`ï¼Œæ€»çš„ç»“æœæ‰ä¼šå˜æˆ`fulfilled`
    - å½“å…¶ä¸­æœ‰ä¸€ä¸ªè¢«`rejected`ï¼Œç»“æœçš„çŠ¶æ€å°±å˜æˆ`rejected`ã€‚

  - `any`ï¼šç›¸å½“äº**or**ã€‚

  - `race`ï¼šè¿”å›ç‡å…ˆæ”¹å˜çŠ¶æ€çš„ Promiseã€‚ç›¸å½“äº**çŸ­è·¯æ“ä½œ**ã€‚

    - ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è·å¾—ç»“æœï¼Œåˆ™`reject`

      ```javascript
      const p = Promise.race([
        fetch('/resource-that-may-take-a-while'),
        new Promise(function (resolve, reject) {
          setTimeout(() => reject(new Error('request timeout')), 5000)
        })
      ]);
      
      p
      .then(console.log)
      .catch(console.error);
      ```

  - `allSettled`ï¼šç­‰åˆ°æ‰€æœ‰è¿™äº›å‚æ•°å®ä¾‹éƒ½è¿”å›ç»“æœï¼Œå›ºå®šè¿”å›`fulfilled`ã€‚ç›¸å½“äº**éçŸ­è·¯æ“ä½œ**ã€‚

- **`Promise.try`**ï¼šç”¨ Promise æ¥å¤„ç†åŒæ­¥å‡½æ•°å’Œå¼‚æ­¥æ“ä½œã€‚

  - ç”¨ç»Ÿä¸€çš„æ¥å£æ¥å¤„ç†åŒæ­¥å’Œå¼‚æ­¥ï¼Œç›®çš„æ˜¯æä¾›äº†è‰¯å¥½çš„é”™è¯¯æ•è·ã€å¯äº¤äº’æ€§å’Œå¯è¯»æ€§ã€‚
  - è§<http://cryto.net/~joepie91/blog/2016/05/11/what-is-promise-try-and-why-does-it-matter/>
  
  
  
  

### å…³äº Stream

å¦‚æœæŸäº›äº‹ä»¶ä¸æ–­åœ°åå¤å‘ç”Ÿï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ [Stream](https://nodejs.org/api/stream.html) æ¨¡å¼æ˜¯æ¯”éƒ¨ç½²`Promise`æ›´å¥½çš„é€‰æ‹©ã€‚

JS ä¸­çš„å¼‚æ­¥ä¸»è¦ä½“ç°åœ¨ IO çš„å¼‚æ­¥ä¸Šã€‚åŒæ ·å¯ä»¥å¤„ç† IO çš„æ–¹æ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨ Streamã€‚å®ƒå…·æœ‰ä¸¤ç§ç‰¹ç‚¹ï¼š

- **äº‹ä»¶é©±åŠ¨**ï¼šä½ å¯ä»¥åœ¨ IO çš„è¿‡ç¨‹ä¸­æ·»åŠ ä¸€äº›äº‹ä»¶å›è°ƒå‡½æ•°ï¼Œç”¨æ¥å¾—çŸ¥è¿›å±•æˆ–å¤„ç†é”™è¯¯ã€‚

  ```javascript
  var readerStream = fs.createReadStream('input.txt');
  readerStream.setEncoding('UTF8');
  
  readerStream.on('data', function(chunk) {
     data += chunk;
  });
  
  readerStream.on('end',function(){
     console.log(data);
  });
  
  readerStream.on('error', function(err){
     console.log(err.stack);
  });
  ```

  

- **ç®¡é“**ï¼šç”¨äºä»ä¸€ä¸ªæµä¸­è·å–æ•°æ®å¹¶å°†æ•°æ®ä¼ é€’åˆ°å¦å¤–ä¸€ä¸ªæµä¸­ã€‚

  ```javascript
  fs.createReadStream('input.txt')
    .pipe(zlib.createGzip())
    .pipe(fs.createWriteStream('input.txt.gz'));
  ```



#### æµçš„ç±»å‹

æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ã€æˆ–è€…å¯è¯»å¯å†™çš„ã€‚ æ‰€æœ‰çš„æµéƒ½æ˜¯ [`EventEmitter`](http://nodejs.cn/api/events.html#events_class_eventemitter) çš„å®ä¾‹ã€‚

Node.js ä¸­æœ‰å››ç§åŸºæœ¬çš„æµç±»å‹ï¼š

- [`Writable`](http://nodejs.cn/api/stream.html#stream_class_stream_writable) - å¯å†™å…¥æ•°æ®çš„æµï¼ˆä¾‹å¦‚ [`fs.createWriteStream()`](http://nodejs.cn/api/fs.html#fs_fs_createwritestream_path_options)ï¼‰ã€‚
- [`Readable`](http://nodejs.cn/api/stream.html#stream_class_stream_readable) - å¯è¯»å–æ•°æ®çš„æµï¼ˆä¾‹å¦‚ [`fs.createReadStream()`](http://nodejs.cn/api/fs.html#fs_fs_createreadstream_path_options)ï¼‰ã€‚
- [`Duplex`](http://nodejs.cn/api/stream.html#stream_class_stream_duplex) - å¯è¯»åˆå¯å†™çš„æµï¼ˆä¾‹å¦‚ [`net.Socket`](http://nodejs.cn/api/net.html#net_class_net_socket)ï¼‰ã€‚
- [`Transform`](http://nodejs.cn/api/stream.html#stream_class_stream_transform) - åœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®çš„ `Duplex` æµï¼ˆä¾‹å¦‚ [`zlib.createDeflate()`](http://nodejs.cn/api/zlib.html#zlib_zlib_createdeflate_options)ï¼‰ã€‚



## Iterator æ¥å£

Iterator æ¥å£çš„ä½œç”¨æœ‰ä¸‰ä¸ªï¼š

- ä¸ºå„ç§æ•°æ®ç»“æ„ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€ä¾¿çš„**è®¿é—®æ¥å£**
- ä½¿å¾—æ•°æ®ç»“æ„çš„æˆå‘˜èƒ½å¤ŸæŒ‰æŸç§**æ¬¡åºæ’åˆ—**
- ES6 åˆ›é€ äº†ä¸€ç§æ–°çš„éå†å‘½ä»¤`for...of`å¾ªç¯ï¼ŒIterator æ¥å£ä¸»è¦ä¾›`for...of`æ¶ˆè´¹ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š

1. è§£æ„èµ‹å€¼
2. å±•å¼€è¿ç®—ç¬¦
3. `yield*`
4. `for ... of`
5. `entries()`ã€`keys()`ã€`values()`
6. å…¶ä»–è°ƒç”¨ Iterator çš„å‡½æ•°



### å®ç°

åœ¨ TS ä¸­ï¼š

```typescript
interface Iterable {
  [Symbol.iterator]() : Iterator,
}

interface Iterator {
  next(value?: any) : IterationResult,
}

interface IterationResult {
  value: any,
  done: boolean,
}
```

åœ¨ JS ä¸­ï¼š

```javascript
// ä½¿ç”¨ Symbol.iterator æ¥å£°æ˜
const obj = {
  [Symbol.iterator] : function () {
    return {
      next: function () {
        return {
          value: 1,
          done: true
        };
      }
    };
  }
};

// ä½¿ç”¨ Generator
let myIterable = {
  [Symbol.iterator]: function* () {
    yield 1;
    yield 2;
    yield 3;
  }
};

// æˆ–è€…é‡‡ç”¨ä¸‹é¢çš„ç®€æ´å†™æ³•
let obj = {
  * [Symbol.iterator]() {
    yield 'hello';
    yield 'world';
  }
};

// return()
function readLinesSync(file) {
  return {
    [Symbol.iterator]() {
      return {
        next() {
          return { done: false };
        },
        return() {
          file.close();
            // å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ˜¯ Generator è¯­æ³•å†³å®šçš„ã€‚
          return { done: true };
        }
      };
    },
  };
}

```

**æ³¨æ„**ï¼š

- Iterator å¯¹è±¡è¿˜å¯ä»¥å…·æœ‰`return()`æ–¹æ³•å’Œ`throw()`æ–¹æ³•ã€‚
  - `return()`æ–¹æ³•çš„ä½¿ç”¨åœºåˆæ˜¯ï¼Œå¦‚æœ`for...of`å¾ªç¯æå‰é€€å‡ºï¼Œå°±ä¼šè°ƒç”¨`return()`æ–¹æ³•ã€‚å®ƒå¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ˜¯ Generator è¯­æ³•å†³å®šçš„ã€‚
  - `throw()`æ–¹æ³•ä¸»è¦æ˜¯é…åˆ Generator å‡½æ•°ä½¿ç”¨ã€‚